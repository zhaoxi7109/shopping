# Shopping App åç«¯æœåŠ¡

åŸºäº Node.js + Express æ„å»ºçš„è´­ç‰©åº”ç”¨åç«¯æœåŠ¡ï¼Œä¸ºå‰ç«¯ UniApp æä¾›å®Œæ•´çš„ API æ”¯æŒã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” ç”¨æˆ·è®¤è¯ä¸æˆæƒï¼ˆJWTï¼‰
- ğŸ‘¤ ç”¨æˆ·ç®¡ç†ï¼ˆæ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ï¼‰
- ğŸ›ï¸ å•†å“ç®¡ç†ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€åˆ†ç±»ã€æœç´¢ï¼‰
- ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½
- ğŸ“¦ è®¢å•ç®¡ç†
- â¤ï¸ æ”¶è—åŠŸèƒ½
- ğŸ  è½®æ’­å›¾ç®¡ç†
- ğŸ” æœç´¢åŠŸèƒ½ï¼ˆå…³é”®è¯ã€çƒ­é—¨æœç´¢ã€æœç´¢å†å²ï¼‰
- ğŸ“± åˆ†ç±»ç®¡ç†
- ğŸ”’ å®‰å…¨é˜²æŠ¤ï¼ˆé™æµã€CORSã€Helmetï¼‰

## æŠ€æœ¯æ ˆ

- **Node.js** - è¿è¡Œç¯å¢ƒ
- **Express** - Web æ¡†æ¶
- **JWT** - èº«ä»½è®¤è¯
- **bcryptjs** - å¯†ç åŠ å¯†
- **express-validator** - è¾“å…¥éªŒè¯
- **cors** - è·¨åŸŸå¤„ç†
- **helmet** - å®‰å…¨é˜²æŠ¤
- **morgan** - è¯·æ±‚æ—¥å¿—
- **multer** - æ–‡ä»¶ä¸Šä¼ 
- **express-rate-limit** - è¯·æ±‚é™æµ

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd server
npm install
```

### 2. ç¯å¢ƒé…ç½®

é¡¹ç›®å·²åŒ…å« `.env` é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```env
# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# JWT é…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH=uploads
MAX_FILE_SIZE=5242880

# API é…ç½®
API_PREFIX=/api
API_VERSION=v1

# CORS é…ç½®
CORS_ORIGIN=*

# åŠ å¯†é…ç½®
BCRYPT_ROUNDS=10

# é™æµé…ç½®
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### 3. åˆå§‹åŒ–æ•°æ®

```bash
# åˆå§‹åŒ–æµ‹è¯•æ•°æ®
node data/init.js
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨

## API æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:3000/api`
- **è®¤è¯æ–¹å¼**: Bearer Token (JWT)
- **æ•°æ®æ ¼å¼**: JSON

### è®¤è¯ç›¸å…³ `/auth`

| æ–¹æ³• | è·¯å¾„             | æè¿°             | è®¤è¯ |
| ---- | ---------------- | ---------------- | ---- |
| POST | `/auth/register` | ç”¨æˆ·æ³¨å†Œ         | âŒ   |
| POST | `/auth/login`    | ç”¨æˆ·ç™»å½•         | âŒ   |
| POST | `/auth/refresh`  | åˆ·æ–° Token       | âŒ   |
| POST | `/auth/logout`   | ç”¨æˆ·ç™»å‡º         | âœ…   |
| GET  | `/auth/me`       | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | âœ…   |

### ç”¨æˆ·ç®¡ç† `/user`

| æ–¹æ³•   | è·¯å¾„                         | æè¿°         | è®¤è¯ |
| ------ | ---------------------------- | ------------ | ---- |
| GET    | `/user/profile`              | è·å–ç”¨æˆ·è¯¦æƒ… | âœ…   |
| PUT    | `/user/profile`              | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | âœ…   |
| PUT    | `/user/password`             | ä¿®æ”¹å¯†ç      | âœ…   |
| PUT    | `/user/avatar`               | æ›´æ–°å¤´åƒ     | âœ…   |
| GET    | `/user/favorites`            | è·å–æ”¶è—åˆ—è¡¨ | âœ…   |
| POST   | `/user/favorites/:productId` | æ·»åŠ æ”¶è—     | âœ…   |
| DELETE | `/user/favorites/:productId` | å–æ¶ˆæ”¶è—     | âœ…   |

### å•†å“ç®¡ç† `/products`

| æ–¹æ³• | è·¯å¾„                             | æè¿°              | è®¤è¯ |
| ---- | -------------------------------- | ----------------- | ---- |
| GET  | `/products`                      | è·å–å•†å“åˆ—è¡¨      | ğŸ”¶   |
| GET  | `/products/:id`                  | è·å–å•†å“è¯¦æƒ…      | ğŸ”¶   |
| GET  | `/products/category/:categoryId` | æŒ‰åˆ†ç±»è·å–å•†å“    | ğŸ”¶   |
| GET  | `/products/hot/list`             | è·å–çƒ­é—¨å•†å“      | ğŸ”¶   |
| GET  | `/products/recommend/list`       | è·å–æ¨èå•†å“      | ğŸ”¶   |
| POST | `/products/:id/favorite`         | æ”¶è—/å–æ¶ˆæ”¶è—å•†å“ | âœ…   |

### åˆ†ç±»ç®¡ç† `/categories`

| æ–¹æ³• | è·¯å¾„                    | æè¿°         | è®¤è¯ |
| ---- | ----------------------- | ------------ | ---- |
| GET  | `/categories`           | è·å–æ‰€æœ‰åˆ†ç±» | âŒ   |
| GET  | `/categories/:id`       | è·å–åˆ†ç±»è¯¦æƒ… | âŒ   |
| GET  | `/categories/tree/list` | è·å–åˆ†ç±»æ ‘   | âŒ   |
| GET  | `/categories/hot/list`  | è·å–çƒ­é—¨åˆ†ç±» | âŒ   |

### è´­ç‰©è½¦ `/cart`

| æ–¹æ³•   | è·¯å¾„                   | æè¿°          | è®¤è¯ |
| ------ | ---------------------- | ------------- | ---- |
| GET    | `/cart`                | è·å–è´­ç‰©è½¦    | âœ…   |
| POST   | `/cart`                | æ·»åŠ åˆ°è´­ç‰©è½¦  | âœ…   |
| PUT    | `/cart/:id`            | æ›´æ–°è´­ç‰©è½¦é¡¹  | âœ…   |
| DELETE | `/cart/:id`            | åˆ é™¤è´­ç‰©è½¦é¡¹  | âœ…   |
| PUT    | `/cart/select/all`     | å…¨é€‰/å–æ¶ˆå…¨é€‰ | âœ…   |
| DELETE | `/cart/selected/items` | åˆ é™¤é€‰ä¸­é¡¹    | âœ…   |
| DELETE | `/cart/clear`          | æ¸…ç©ºè´­ç‰©è½¦    | âœ…   |

### è®¢å•ç®¡ç† `/orders`

| æ–¹æ³• | è·¯å¾„                         | æè¿°         | è®¤è¯ |
| ---- | ---------------------------- | ------------ | ---- |
| POST | `/orders`                    | åˆ›å»ºè®¢å•     | âœ…   |
| GET  | `/orders`                    | è·å–è®¢å•åˆ—è¡¨ | âœ…   |
| GET  | `/orders/:id`                | è·å–è®¢å•è¯¦æƒ… | âœ…   |
| PUT  | `/orders/:id/cancel`         | å–æ¶ˆè®¢å•     | âœ…   |
| PUT  | `/orders/:id/confirm`        | ç¡®è®¤æ”¶è´§     | âœ…   |
| POST | `/orders/:id/pay`            | æ”¯ä»˜è®¢å•     | âœ…   |
| GET  | `/orders/statistics/summary` | è®¢å•ç»Ÿè®¡     | âœ…   |

### è½®æ’­å›¾ `/banners`

| æ–¹æ³• | è·¯å¾„           | æè¿°           | è®¤è¯ |
| ---- | -------------- | -------------- | ---- |
| GET  | `/banners`     | è·å–è½®æ’­å›¾åˆ—è¡¨ | âŒ   |
| GET  | `/banners/:id` | è·å–è½®æ’­å›¾è¯¦æƒ… | âŒ   |

### æœç´¢åŠŸèƒ½ `/search`

| æ–¹æ³•   | è·¯å¾„                  | æè¿°           | è®¤è¯ |
| ------ | --------------------- | -------------- | ---- |
| GET    | `/search`             | æœç´¢å•†å“       | ğŸ”¶   |
| GET    | `/search/suggestions` | è·å–æœç´¢å»ºè®®   | âŒ   |
| GET    | `/search/hot`         | è·å–çƒ­é—¨æœç´¢è¯ | âŒ   |
| GET    | `/search/history`     | è·å–æœç´¢å†å²   | âœ…   |
| DELETE | `/search/history`     | æ¸…ç©ºæœç´¢å†å²   | âœ…   |

**å›¾ä¾‹è¯´æ˜ï¼š**

- âœ… éœ€è¦è®¤è¯
- âŒ æ— éœ€è®¤è¯
- ğŸ”¶ å¯é€‰è®¤è¯ï¼ˆç™»å½•åæœ‰é¢å¤–åŠŸèƒ½ï¼‰

## æ•°æ®å­˜å‚¨

é¡¹ç›®ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿæ•°æ®åº“ï¼Œæ•°æ®å­˜å‚¨åœ¨ `data/` ç›®å½•ä¸‹ï¼š

```
data/
â”œâ”€â”€ users.json          # ç”¨æˆ·æ•°æ®
â”œâ”€â”€ products.json       # å•†å“æ•°æ®
â”œâ”€â”€ categories.json     # åˆ†ç±»æ•°æ®
â”œâ”€â”€ cart.json          # è´­ç‰©è½¦æ•°æ®
â”œâ”€â”€ orders.json        # è®¢å•æ•°æ®
â”œâ”€â”€ favorites.json     # æ”¶è—æ•°æ®
â”œâ”€â”€ banners.json       # è½®æ’­å›¾æ•°æ®
â”œâ”€â”€ hotSearches.json   # çƒ­é—¨æœç´¢è¯
â””â”€â”€ searchHistory.json # æœç´¢å†å²
```

## æµ‹è¯•è´¦å·

åˆå§‹åŒ–æ•°æ®åï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•è´¦å·ï¼š

**ç®¡ç†å‘˜è´¦å·ï¼š**

- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`123456`

**æ™®é€šç”¨æˆ·ï¼š**

- ç”¨æˆ·åï¼š`user1`
- å¯†ç ï¼š`123456`

## é”™è¯¯å¤„ç†

æ‰€æœ‰ API å“åº”éƒ½éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "data": {},
  "message": "æ“ä½œæˆåŠŸ"
}
```

**é”™è¯¯å“åº”ï¼š**

```json
{
  "success": false,
  "error": "é”™è¯¯ä¿¡æ¯",
  "details": []
}
```

## å®‰å…¨ç‰¹æ€§

- JWT Token è®¤è¯
- å¯†ç  bcrypt åŠ å¯†
- è¯·æ±‚é™æµä¿æŠ¤
- CORS è·¨åŸŸé…ç½®
- Helmet å®‰å…¨å¤´è®¾ç½®
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤

## å¼€å‘è¯´æ˜

### ç›®å½•ç»“æ„

```
server/
â”œâ”€â”€ app.js              # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json        # ä¾èµ–é…ç½®
â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡
â”œâ”€â”€ README.md          # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ data/              # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ init.js        # åˆå§‹åŒ–æ•°æ®è„šæœ¬
â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.js        # è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ errorHandler.js # é”™è¯¯å¤„ç†
â”‚   â””â”€â”€ notFound.js    # 404å¤„ç†
â”œâ”€â”€ routes/            # è·¯ç”±
â”‚   â”œâ”€â”€ auth.js        # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ user.js        # ç”¨æˆ·è·¯ç”±
â”‚   â”œâ”€â”€ product.js     # å•†å“è·¯ç”±
â”‚   â”œâ”€â”€ category.js    # åˆ†ç±»è·¯ç”±
â”‚   â”œâ”€â”€ cart.js        # è´­ç‰©è½¦è·¯ç”±
â”‚   â”œâ”€â”€ order.js       # è®¢å•è·¯ç”±
â”‚   â”œâ”€â”€ banner.js      # è½®æ’­å›¾è·¯ç”±
â”‚   â””â”€â”€ search.js      # æœç´¢è·¯ç”±
â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
    â”œâ”€â”€ dataStore.js   # æ•°æ®å­˜å‚¨å·¥å…·
    â””â”€â”€ jwt.js         # JWTå·¥å…·
```

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `routes/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶
2. åœ¨ `app.js` ä¸­æ³¨å†Œæ–°è·¯ç”±
3. å¦‚éœ€è¦ï¼Œåœ¨ `middleware/` ä¸­æ·»åŠ ç›¸åº”ä¸­é—´ä»¶
4. æ›´æ–° `data/init.js` æ·»åŠ åˆå§‹æ•°æ®

## éƒ¨ç½²è¯´æ˜

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„æ•æ„Ÿé…ç½®
2. è®¾ç½® `NODE_ENV=production`
3. ä½¿ç”¨ PM2 æˆ–å…¶ä»–è¿›ç¨‹ç®¡ç†å™¨
4. é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
5. å¯ç”¨ HTTPS

### Docker éƒ¨ç½²

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚
